!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("ffi-napi"),require("ref-array-napi"),require("winreg")):"function"==typeof define&&define.amd?define(["exports","ffi-napi","ref-array-napi","winreg"],t):t((e||self).voicemeeterConnector={},e.ffiNapi,e.refArrayNapi,e.winreg)}(this,function(e,t,r,n){function o(e){return e&&"object"==typeof e&&"default"in e?e:{default:e}}var i,a,u,m,s,c,l,d,p,f,B,v=/*#__PURE__*/o(t),A=/*#__PURE__*/o(r),y=/*#__PURE__*/o(n);!function(e){e.Mono="Mono",e.Mute="Mute",e.Solo="Solo",e.MC="MC",e.Gain="Gain",e.GainLayer0="GainLayer[0]",e.GainLayer1="GainLayer[1]",e.GainLayer2="GainLayer[2]",e.GainLayer3="GainLayer[3]",e.GainLayer4="GainLayer[4]",e.GainLayer5="GainLayer[5]",e.GainLayer6="GainLayer[6]",e.GainLayer7="GainLayer[7]",e.Pan_x="Pan_x",e.Pan_y="Pan_y",e.Color_x="Color_x",e.Color_y="Color_y",e.fx_x="fx_x",e.fx_y="fx_y",e.Audibility="Audibility",e.Comp="Comp",e.CompGainIn="Comp.GainIn",e.CompRatio="Comp.Ratio",e.CompThreshold="Comp.Threshold",e.CompAttack="Comp.Attack",e.CompRelease="Comp.Release",e.CompKnee="Comp.Knee",e.CompGainOut="Comp.GainOut",e.CompMakeUp="Comp.MakeUp",e.Gate="Gate",e.GateThreshold="Gate.Threshold",e.GateDamping="Gate.Damping",e.GateBPSidechain="Gate.BPSidechain",e.GateAttack="Gate.Attack",e.GateHold="Gate.Hold",e.GateRelease="Gate.Release",e.Denoiser="Denoiser",e.Karaoke="Karaoke",e.Limit="Limit",e.EqGain1="EqGain1",e.EqGain2="EqGain2",e.EqGain3="EqGain3",e.Label="Label",e.A1="A1",e.A2="A2",e.A3="A3",e.A4="A4",e.A5="A5",e.B1="B1",e.B2="B2",e.B3="B3",e.FadeTo="FadeTo",e.FadeBy="FadeBy",e.Reverb="Reverb",e.Delay="Delay",e.Fx1="Fx1",e.Fx2="Fx2",e.PostReverb="PostReverb",e.PostDelay="PostDelay",e.PostFx1="PostFx1",e.PostFx2="PostFx2",e.EQon="EQ.on",e.EQAB="EQ.AB",e.AppGain="AppGain",e.APpMute="AppMute",e.DeviceName="device.name",e.DeviceSR="device.sr",e.DeviceWDM="device.wdm",e.DeviceKS="device.ks",e.DeviceMME="device.mme",e.DeviceASIO="device.asio"}(i||(i={})),(B=a||(a={})).Mono="Mono",B.Mute="Mute",B.EQ="EQ.on",B.EQon="EQ.on",B.EQAB="EQ.AB",B.Gain="Gain",B.Label="Label",B.ModeNormal="mode.normal",B.ModeAmix="mode.Amix",B.ModeBmix="mode.Bmix",B.ModeRepeat="mode.Repeat",B.ModeComposite="mode.Composite",B.ModeTVMix="mode.TVMix",B.ModeUpMix21="mode.UpMix21",B.ModeUpMix41="mode.UpMix41",B.ModeUpMix61="mode.UpMix61",B.ModeCenterOnly="mode.CenterOnly",B.ModeLFEOnly="mode.LFEOnly",B.ModeRearOnly="mode.RearOnly",B.FadeTo="FadeTo",B.FadeBy="FadeBy",B.Sel="Sel",B.ReturnReverb="ReturnReverb",B.ReturnDelay="ReturnDelay",B.ReturnFx1="ReturnFx1",B.ReturnFx2="ReturnFx2",B.Monitor="Monitor",B.DeviceName="device.name",B.DeviceSR="device.sr",B.DeviceWDM="device.wdm",B.DeviceKS="device.ks",B.DeviceMME="device.mme",B.DeviceASIO="device.asio",function(e){e.ReverbOn="Reverb.On",e.ReverbAB="Reverb.AB",e.DelayOn="Delay.On",e.DelayAB="Delay.AB"}(u||(u={})),function(e){e.Stop="stop",e.Play="play",e.Replay="replay",e.FastForward="ff",e.Rewind="rew",e.GoTo="goto",e.A1="A1",e.A2="A2",e.A3="A3",e.A4="A4",e.A5="A5",e.B1="B1",e.B2="B2",e.B3="B3",e.Record="record",e.Pause="pause",e.Load="load",e.SampleRate="samplerate",e.ArmStrip0="ArmStrip(0)",e.ArmStrip1="ArmStrip(1)",e.ArmStrip2="ArmStrip(2)",e.ArmStrip3="ArmStrip(3)",e.ArmStrip4="ArmStrip(4)",e.ArmStrip5="ArmStrip(5)",e.ArmStrip6="ArmStrip(6)",e.ArmStrip7="ArmStrip(7)",e.ArmStrip8="ArmStrip(8)",e.ArmBus0="ArmBus(0)",e.ArmBus1="ArmBus(1)",e.ArmBus2="ArmBus(2)",e.ArmBus3="ArmBus(3)",e.ArmBus4="ArmBus(4)",e.ArmBus5="ArmBus(5)",e.ArmBus6="ArmBus(6)",e.ArmBus7="ArmBus(7)",e.ArmBus8="ArmBus(8)",e.ModeRecBus="mode.recbus",e.ModePlayOnLoad="mode.PlayOnLoad",e.ModeLoop="mode.Loop",e.ModeMultiTrack="mode.MultiTrack",e.BitResolution="bitResolution",e.Channel="Channel",e.KBPS="kbps",e.FileType="FileType",e.Gain="Gain"}(m||(m={})),function(e){e.Shutdown="Shutdown",e.Show="Show",e.Restart="Restart",e.Eject="Eject",e.Reset="Reset",e.Save="Save",e.Load="Load",e.Lock="Lock",e.DialogShowVBANChat="DialogShow.VBANCHAT"}(s||(s={})),function(e){e.State="ButtonState",e.StateOnly="ButtonStateOnly",e.Trigger="ButtonTrigger",e.Color="ButtonColor"}(c||(c={})),function(e){e.SaveBus="EqSaveBus",e.LoadBus="EqLoadBus",e.SaveStrip="EqSaveStrip",e.LoadStrip="EqLoadStrip"}(l||(l={})),function(e){e.Enable="Enable"}(d||(d={})),function(e){e.On="on",e.Name="name",e.IP="ip",e.Port="port",e.SR="sr",e.Channel="channel",e.Bit="bit",e.Quality="quality",e.Route="route"}(p||(p={})),function(e){e.On="on",e.Name="name",e.IP="ip",e.Port="port",e.SR="sr",e.Channel="channel",e.Bit="bit",e.Quality="quality",e.Route="route"}(f||(f={}));var h,S,g=A.default("char"),V=A.default("long"),C=A.default("float"),P=/*#__PURE__*/function(){function e(){var e=this;this.isInitialised=!1,this.isConnected=!1,this.outputDevices=[],this.inputDevices=[],this.version="",this.type=void 0,this.eventPool=[],this.connect=function(){if(!e.isInitialised)throw new Error("Await the initialisation before connect");if(!e.isConnected){if(0===h.VBVMR_Login())return e.isConnected=!0,e.type=e.getVoicemeeterType(),e.version=e.getVoicemeeterVersion(),void setInterval(e.checkPropertyChange,10);throw e.isConnected=!1,new Error("Connection failed")}},this.disconnect=function(){if(!e.isConnected)throw new Error("Not connected");try{if(0===h.VBVMR_Logout())return void(e.isConnected=!1);throw new Error("Disconnect failed")}catch(e){throw new Error("Disconnect failed")}},this.updateDeviceList=function(){if(!e.isConnected)throw new Error("Not connected");e.outputDevices=[],e.inputDevices=[];for(var t=h.VBVMR_Output_GetDeviceNumber(),r=0;r<t;r++){var n=new g(256),o=new g(256),i=new V(1);h.VBVMR_Output_GetDeviceDescA(r,i,o,n),e.outputDevices.push({name:String.fromCharCode.apply(String,o.toArray()).replace(/\u0000+$/g,""),hardwareId:String.fromCharCode.apply(String,n.toArray()).replace(/\u0000+$/g,""),type:i[0]})}for(var a=h.VBVMR_Input_GetDeviceNumber(),u=0;u<a;u++){var m=new g(256),s=new g(256),c=new V(1);h.VBVMR_Input_GetDeviceDescA(u,c,s,m),e.inputDevices.push({name:String.fromCharCode.apply(String,s.toArray()).replace(/\u0000+$/g,""),hardwareId:String.fromCharCode.apply(String,m.toArray()).replace(/\u0000+$/g,""),type:c[0]})}},this.isParametersDirty=function(){return h.VBVMR_IsParametersDirty()},this.getBusParameter=function(t,r){return e.getParameter("Bus",t,r)},this.setBusParameter=function(t,r,n){return e.setParameter("Bus",t,r,n)},this.getLevel=function(t,r){if(!e.isConnected)throw new Error("Not correct connected");var n=new C(1);return h.VBVMR_GetLevel(t,r,n),n[0]},this.getRecorderParameter=function(t){return e.getParameter("Recorder",0,t)},this.setRecorderParameter=function(t,r){return e.setParameter("Recorder",0,t,r)},this.getStripParameter=function(t,r){return e.getParameter("Strip",t,r)},this.setStripParameter=function(t,r,n){return e.setParameter("Strip",t,r,n)},this.getVBANParameter=function(){return e.getParameter("VBAN",0,d.Enable)},this.setVBANParameter=function(t){return e.setParameter("VBAN",0,d.Enable,t)},this.getVBANInstreamParameter=function(t,r){return e.getParameter("VBANInstream",t,r)},this.setVBANInstreamParameter=function(t,r,n){return e.setParameter("VBANInstream",t,r,n)},this.getVBANOutstreamParameter=function(t,r){return e.getParameter("VBANOutstream",t,r)},this.setVBANOutstreamParameter=function(t,r,n){return e.setParameter("VBANOutstream",t,r,n)},this.executeCommandAction=function(t,r){return e.setParameter("Command",0,t,r)},this.executeButtonAction=function(t,r,n){return e.setParameter("Command",t,r,n)},this.executeEqAction=function(t,r,n){return e.setParameter("Command",t,r,n)},this.getVMState=function(t){return e.getParameter("Command",0,t)},this.getButtonParameter=function(t,r){return e.getParameter("Command",t,r)},this.attachChangeEvent=function(t){e.eventPool.push(t)},this.setOption=function(e){var t=Buffer.alloc(e.length+1);return t.fill(0).write(e),h.VBVMR_SetParameters(t),new Promise(function(e){return setTimeout(e,200)})},this.checkPropertyChange=function(){1===e.isParametersDirty()&&e.eventPool.forEach(function(e){e()})},this.getVoicemeeterType=function(){var e=new V(1);if(0!==h.VBVMR_GetVoicemeeterType(e))throw new Error("running failed");switch(e[0]){case 1:return"voicemeeter";case 2:return"voicemeeterBanana";case 3:return"voicemeeterPotato";default:throw new Error("Voicemeeter seems not to be installed")}},this.getVoicemeeterVersion=function(){var e=new V(1);if(0!==h.VBVMR_GetVoicemeeterVersion(e))throw new Error("running failed");return e},this.getParameter=function(t,r,n){var o=t+"."+n;if("Strip"===t||"Bus"===t?o=t+"["+r+"]."+n:"Command"===t?(o="Command."+n,n===c.State&&(o="Command.Button["+r+"].State"),n===c.State&&(o="Command.Button["+r+"].StateOnly"),n===c.State&&(o="Command.Button["+r+"].Trigger"),n===c.State&&(o="Command.Button["+r+"].Color")):"VBAN"===t?o="vban.Enable":"VBANInstream"===t?o="vban.instream["+r+"]."+n:"VBANOutstream"===t&&(o="vban.outstream["+r+"]."+n),!e.isConnected)throw new Error("Not correct connected");var i=Buffer.alloc(o.length+1);i.write(o);var a=null;return["Label","FadeTo","FadeBy","AppGain","AppMute","device.name"].indexOf(n)>-1?(a=new g(512),h.VBVMR_GetParameterStringA(i,a),String.fromCharCode.apply(null,a).split("").filter(function(e){return"\0"!==e}).join("")):(a=new C(1),h.VBVMR_GetParameterFloat(i,a),a[0])},this.setParameter=function(t,r,n,o){if(!e.isConnected)throw new Error("Not connected");var i="";return"Strip"===t||"Bus"===t?i=t+"["+r+"]."+n+"="+o+";":"Command"===t?(i="Command."+n+"="+o+";",n===c.State&&(i="Command.Button["+r+"].State="+o+";"),n===c.StateOnly&&(i="Command.Button["+r+"].StateOnly="+o+";"),n===c.Trigger&&(i="Command.Button["+r+"].Trigger="+o+";"),n===c.Color&&(i="Command.Button["+r+"].Color="+o+";"),n===l.SaveBus&&(i="Command.SaveBUSEQ["+r+"]="+o+";"),n===l.LoadBus&&(i="Command.LoadBUSEQ["+r+"]="+o+";"),n===l.SaveStrip&&(i="Command.SaveStripEQ["+r+"]="+o+";"),n===l.LoadStrip&&(i="Command.LoadStripEQ["+r+"]="+o+";")):i="VBAN"===t?"vban.Enable="+o:"VBANInstream"===t?"vban.instream["+r+"]."+n+"="+o:"VBANOutstream"===t?"vban.outstream["+r+"]."+n+"="+o:t+"."+n+"="+o+";",e.setOption(i)},this.setRaw=function(t){return e.setOption(t)}}var t,r;return e.init=function(){try{return Promise.resolve(function(){try{var e=new y.default({hive:y.default.HKLM,key:"\\SOFTWARE\\WOW6432Node\\Microsoft\\Windows\\CurrentVersion\\Uninstall\\VB:Voicemeeter {17359A74-1236-5467}"});return Promise.resolve(new Promise(function(t){e.values(function(e,r){if(e)throw new Error(e);var n=r.find(function(e){return"UninstallString"===e.name}).value,o=n.lastIndexOf("\\");t(n.slice(0,o))})}))}catch(e){return Promise.reject(e)}}()).then(function(t){return new Promise(function(r){S||(S=new e),h=v.default.Library(t+"/VoicemeeterRemote64.dll",{VBVMR_Login:["long",[]],VBVMR_Logout:["long",[]],VBVMR_RunVoicemeeter:["long",["long"]],VBVMR_IsParametersDirty:["long",[]],VBVMR_GetLevel:["long",["long","long",C]],VBVMR_GetParameterFloat:["long",[g,C]],VBVMR_GetParameterStringA:["long",[g,g]],VBVMR_SetParameters:["long",[g]],VBVMR_Output_GetDeviceNumber:["long",[]],VBVMR_Output_GetDeviceDescA:["long",["long",V,g,g]],VBVMR_Input_GetDeviceNumber:["long",[]],VBVMR_Input_GetDeviceDescA:["long",["long",V,g,g]],VBVMR_GetVoicemeeterType:["long",[V]],VBVMR_GetVoicemeeterVersion:["long",[V]]}),S.isInitialised=!0,r(S)})})}catch(e){return Promise.reject(e)}},t=e,(r=[{key:"$outputDevices",get:function(){return this.outputDevices}},{key:"$inputDevices",get:function(){return this.inputDevices}},{key:"$version",get:function(){return this.version}},{key:"$type",get:function(){return this.type}}])&&function(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,"symbol"==typeof(o=function(e,t){if("object"!=typeof e||null===e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,"string");if("object"!=typeof n)return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(n.key))?o:String(o),n)}var o}(t.prototype,r),Object.defineProperty(t,"prototype",{writable:!1}),e}(),R=i,M=u,w=m,G=s,D=c,b=l,E=d,L=p,_=f;e.BusProperties=a,e.CommandActions=G,e.CommandButtons=D,e.CommandEqs=b,e.FXSettings=M,e.InterfaceTypes={strip:0,bus:1},e.RecorderProperties=w,e.StripProperties=R,e.VBAN=E,e.VBANInstream=L,e.VBANOutstream=_,e.Voicemeeter=P,e.types={__proto__:null}});
//# sourceMappingURL=index.umd.js.map
