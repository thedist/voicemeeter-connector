import e from"ffi-napi";import t from"ref-array-napi";import r from"winreg";var o,i,a,n,s,m,c;!function(e){e.Mono="Mono",e.Mute="Mute",e.Solo="Solo",e.MC="MC",e.Gain="Gain",e.GainLayer0="GainLayer[0]",e.GainLayer1="GainLayer[1]",e.GainLayer2="GainLayer[2]",e.GainLayer3="GainLayer[3]",e.GainLayer4="GainLayer[4]",e.GainLayer5="GainLayer[5]",e.GainLayer6="GainLayer[6]",e.GainLayer7="GainLayer[7]",e.Pan_x="Pan_x",e.Pan_y="Pan_y",e.Color_x="Color_x",e.Color_y="Color_y",e.fx_x="fx_x",e.fx_y="fx_y",e.Audibility="Audibility",e.Comp="Comp",e.CompGainIn="Comp.GainIn",e.CompRatio="Comp.Ratio",e.CompThreshold="Comp.Threshold",e.CompAttack="Comp.Attack",e.CompRelease="Comp.Release",e.CompKnee="Comp.Knee",e.CompGainOut="Comp.GainOut",e.CompMakeUp="Comp.MakeUp",e.Gate="Gate",e.GateThreshold="Gate.Threshold",e.GateDamping="Gate.Damping",e.GateBPSidechain="Gate.BPSidechain",e.GateAttack="Gate.Attack",e.GateHold="Gate.Hold",e.GateRelease="Gate.Release",e.Denoiser="Denoiser",e.Karaoke="Karaoke",e.Limit="Limit",e.EqGain1="EqGain1",e.EqGain2="EqGain2",e.EqGain3="EqGain3",e.Label="Label",e.A1="A1",e.A2="A2",e.A3="A3",e.A4="A4",e.A5="A5",e.B1="B1",e.B2="B2",e.B3="B3",e.FadeTo="FadeTo",e.FadeBy="FadeBy",e.Reverb="Reverb",e.Delay="Delay",e.Fx1="Fx1",e.Fx2="Fx2",e.PostReverb="PostReverb",e.PostDelay="PostDelay",e.PostFx1="PostFx1",e.PostFx2="PostFx2",e.EQon="EQ.on",e.EQAB="EQ.AB",e.AppGain="AppGain",e.APpMute="AppMute",e.DeviceName="device.name",e.DeviceSR="device.sr",e.DeviceWDM="device.wdm",e.DeviceKS="device.ks",e.DeviceMME="device.mme",e.DeviceASIO="device.asio"}(o||(o={})),function(e){e.Mono="Mono",e.Mute="Mute",e.EQ="EQ.on",e.EQon="EQ.on",e.EQAB="EQ.AB",e.Gain="Gain",e.Label="Label",e.ModeNormal="mode.normal",e.ModeAmix="mode.Amix",e.ModeBmix="mode.Bmix",e.ModeRepeat="mode.Repeat",e.ModeComposite="mode.Composite",e.ModeTVMix="mode.TVMix",e.ModeUpMix21="mode.UpMix21",e.ModeUpMix41="mode.UpMix41",e.ModeUpMix61="mode.UpMix61",e.ModeCenterOnly="mode.CenterOnly",e.ModeLFEOnly="mode.LFEOnly",e.ModeRearOnly="mode.RearOnly",e.FadeTo="FadeTo",e.FadeBy="FadeBy",e.Sel="Sel",e.ReturnReverb="ReturnReverb",e.ReturnDelay="ReturnDelay",e.ReturnFx1="ReturnFx1",e.ReturnFx2="ReturnFx2",e.Monitor="Monitor",e.DeviceName="device.name",e.DeviceSR="device.sr",e.DeviceWDM="device.wdm",e.DeviceKS="device.ks",e.DeviceMME="device.mme",e.DeviceASIO="device.asio"}(i||(i={})),function(e){e.ReverbOn="Reverb.On",e.ReverbAB="Reverb.AB",e.DelayOn="Delay.On",e.DelayAB="Delay.AB"}(a||(a={})),function(e){e.Stop="stop",e.Play="play",e.Replay="replay",e.FastForward="ff",e.Rewind="rew",e.GoTo="goto",e.A1="A1",e.A2="A2",e.A3="A3",e.A4="A4",e.A5="A5",e.B1="B1",e.B2="B2",e.B3="B3",e.Record="record",e.Pause="pause",e.Load="load",e.SampleRate="samplerate",e.ArmStrip0="ArmStrip(0)",e.ArmStrip1="ArmStrip(1)",e.ArmStrip2="ArmStrip(2)",e.ArmStrip3="ArmStrip(3)",e.ArmStrip4="ArmStrip(4)",e.ArmStrip5="ArmStrip(5)",e.ArmStrip6="ArmStrip(6)",e.ArmStrip7="ArmStrip(7)",e.ArmStrip8="ArmStrip(8)",e.ArmBus0="ArmBus(0)",e.ArmBus1="ArmBus(1)",e.ArmBus2="ArmBus(2)",e.ArmBus3="ArmBus(3)",e.ArmBus4="ArmBus(4)",e.ArmBus5="ArmBus(5)",e.ArmBus6="ArmBus(6)",e.ArmBus7="ArmBus(7)",e.ArmBus8="ArmBus(8)",e.ModeRecBus="mode.recbus",e.ModePlayOnLoad="mode.PlayOnLoad",e.ModeLoop="mode.Loop",e.ModeMultiTrack="mode.MultiTrack",e.BitResolution="bitResolution",e.Channel="Channel",e.KBPS="kbps",e.FileType="FileType",e.Gain="Gain"}(n||(n={})),function(e){e.Shutdown="Shutdown",e.Show="Show",e.Restart="Restart",e.Eject="Eject",e.Reset="Reset",e.Save="Save",e.Load="Load",e.Lock="Lock",e.DialogShowVBANChat="DialogShow.VBANCHAT"}(s||(s={})),function(e){e.State="ButtonState",e.StateOnly="ButtonStateOnly",e.Trigger="ButtonTrigger",e.Color="ButtonColor"}(m||(m={})),function(e){e.SaveBus="EqSaveBus",e.LoadBus="EqLoadBus",e.SaveStrip="EqSaveStrip",e.LoadStrip="EqLoadStrip"}(c||(c={}));var u={__proto__:null,InterfaceTypes:{strip:0,bus:1},get StripProperties(){return o},get BusProperties(){return i},get FXSettings(){return a},get RecorderProperties(){return n},get CommandActions(){return s},get CommandButtons(){return m},get CommandEqs(){return c}};const d=t("char"),l=t("long"),p=t("float");let h,B;class A{constructor(){this.isInitialised=!1,this.isConnected=!1,this.outputDevices=[],this.inputDevices=[],this.version="",this.type=void 0,this.eventPool=[],this.connect=()=>{if(!this.isInitialised)throw new Error("Await the initialisation before connect");if(!this.isConnected){if(0===h.VBVMR_Login())return this.isConnected=!0,this.type=this.getVoicemeeterType(),this.version=this.getVoicemeeterVersion(),void setInterval(this.checkPropertyChange,10);throw this.isConnected=!1,new Error("Connection failed")}},this.disconnect=()=>{if(!this.isConnected)throw new Error("Not connected ");try{if(0===h.VBVMR_Logout())return void(this.isConnected=!1);throw new Error("Disconnect failed")}catch(e){throw new Error("Disconnect failed")}},this.updateDeviceList=()=>{if(!this.isConnected)throw new Error("Not connected ");this.outputDevices=[],this.inputDevices=[];const e=h.VBVMR_Output_GetDeviceNumber();for(let t=0;t<e;t++){const e=new d(256),r=new d(256),o=new l(1);h.VBVMR_Output_GetDeviceDescA(t,o,r,e),this.outputDevices.push({name:String.fromCharCode(...r.toArray()).replace(/\u0000+$/g,""),hardwareId:String.fromCharCode(...e.toArray()).replace(/\u0000+$/g,""),type:o[0]})}const t=h.VBVMR_Input_GetDeviceNumber();for(let e=0;e<t;e++){const t=new d(256),r=new d(256),o=new l(1);h.VBVMR_Input_GetDeviceDescA(e,o,r,t),this.inputDevices.push({name:String.fromCharCode(...r.toArray()).replace(/\u0000+$/g,""),hardwareId:String.fromCharCode(...t.toArray()).replace(/\u0000+$/g,""),type:o[0]})}},this.isParametersDirty=()=>h.VBVMR_IsParametersDirty(),this.getBusParameter=(e,t)=>this.getParameter("Bus",e,t),this.setBusParameter=(e,t,r)=>this.setParameter("Bus",e,t,r),this.getLevel=(e,t)=>{if(!this.isConnected)throw new Error("Not correct connected ");let r=new p(1);return h.VBVMR_GetLevel(e,t,r),r[0]},this.getRecorderParameter=e=>this.getParameter("Recorder",0,e),this.setRecorderParameter=(e,t)=>this.setParameter("Recorder",0,e,t),this.getStripParameter=(e,t)=>this.getParameter("Strip",e,t),this.setStripParameter=(e,t,r)=>this.setParameter("Strip",e,t,r),this.executeCommandAction=(e,t)=>this.setParameter("Command",0,e,t),this.executeButtonAction=(e,t,r)=>this.setParameter("Command",e,t,r),this.executeEqAction=(e,t,r)=>this.setParameter("Command",e,t,r),this.getVMState=e=>this.getParameter("Command",0,e),this.getButtonParameter=(e,t)=>this.getParameter("Command",e,t),this.attachChangeEvent=e=>{this.eventPool.push(e)},this.setOption=e=>{const t=Buffer.alloc(e.length+1);return t.fill(0).write(e),h.VBVMR_SetParameters(t),new Promise(e=>setTimeout(e,200))},this.checkPropertyChange=()=>{1===this.isParametersDirty()&&this.eventPool.forEach(e=>{e()})},this.getVoicemeeterType=()=>{const e=new l(1);if(0!==h.VBVMR_GetVoicemeeterType(e))throw new Error("running failed");switch(e[0]){case 1:return"voicemeeter";case 2:return"voicemeeterBanana";case 3:return"voicemeeterPotato";default:throw new Error("Voicemeeter seems not to be installed")}},this.getVoicemeeterVersion=()=>{const e=new l(1);if(0!==h.VBVMR_GetVoicemeeterVersion(e))throw new Error("running failed");return e},this.getParameter=(e,t,r)=>{let o="";switch(e){case"Strip":case"Bus":o=`${e}[${t}].${r}`;break;case"Command":switch(r){case m.State:o=`Command.Button[${t}].State`;case m.StateOnly:o=`Command.Button[${t}].StateOnly`;case m.Trigger:o=`Command.Button[${t}].Trigger`;case m.Color:o=`Command.Button[${t}].Color`;default:o=`Command.${r}`}break;default:o=`${e}.${r}`}if(!this.isConnected)throw new Error("Not correct connected ");const i=Buffer.alloc(o.length+1);i.write(o);let a=null;return["Label","FadeTo","FadeBy","AppGain","AppMute","device.name"].indexOf(r)>-1?(a=new d(512),h.VBVMR_GetParameterStringA(i,a),String.fromCharCode.apply(null,a).split("").filter(e=>"\0"!==e).join("")):(a=new p(1),h.VBVMR_GetParameterFloat(i,a),a[0])},this.setParameter=(e,t,r,o)=>{if(!this.isConnected)throw new Error("Not connected ");let i="";switch(e){case"Strip":case"Bus":i=`${e}[${t}].${r}=${o};`;break;case"Command":switch(r){case m.State:i=`Command.Button[${t}].State=${o};`;case m.StateOnly:i=`Command.Button[${t}].StateOnly=${o};`;case m.Trigger:i=`Command.Button[${t}].Trigger=${o};`;case m.Color:i=`Command.Button[${t}].Color=${o};`;case c.SaveBus:i=`Command.SaveBUSEQ[${t}]=${o};`;case c.LoadBus:i=`Command.LoadBUSEQ[${t}]=${o};`;case c.SaveStrip:i=`Command.SaveStripEQ[${t}]=${o};`;case c.LoadStrip:i=`Command.LoadStripEQ[${t}]=${o};`;default:i=`Command.${r}=${o};`}break;default:i=`${e}.${r}=${o};`}return this.setOption(i)}}static async init(){const t=await(async()=>{const e=new r({hive:r.HKLM,key:"\\SOFTWARE\\WOW6432Node\\Microsoft\\Windows\\CurrentVersion\\Uninstall\\VB:Voicemeeter {17359A74-1236-5467}"});return new Promise(t=>{e.values((e,r)=>{if(e)throw new Error(e);const o=r.find(e=>"UninstallString"===e.name).value,i=o.lastIndexOf("\\");t(o.slice(0,i))})})})();return new Promise(r=>{B||(B=new A),h=e.Library(`${t}/VoicemeeterRemote64.dll`,{VBVMR_Login:["long",[]],VBVMR_Logout:["long",[]],VBVMR_RunVoicemeeter:["long",["long"]],VBVMR_IsParametersDirty:["long",[]],VBVMR_GetLevel:["long",["long","long",p]],VBVMR_GetParameterFloat:["long",[d,p]],VBVMR_GetParameterStringA:["long",[d,d]],VBVMR_SetParameters:["long",[d]],VBVMR_Output_GetDeviceNumber:["long",[]],VBVMR_Output_GetDeviceDescA:["long",["long",l,d,d]],VBVMR_Input_GetDeviceNumber:["long",[]],VBVMR_Input_GetDeviceDescA:["long",["long",l,d,d]],VBVMR_GetVoicemeeterType:["long",[l]],VBVMR_GetVoicemeeterVersion:["long",[l]]}),B.isInitialised=!0,r(B)})}get $outputDevices(){return this.outputDevices}get $inputDevices(){return this.inputDevices}get $version(){return this.version}get $type(){return this.type}}var S={__proto__:null};const{BusProperties:C,InterfaceTypes:g,StripProperties:y,FXSettings:v,RecorderProperties:M,CommandActions:R,CommandButtons:V,CommandEqs:G}=u;export{C as BusProperties,R as CommandActions,V as CommandButtons,G as CommandEqs,v as FXSettings,g as InterfaceTypes,M as RecorderProperties,y as StripProperties,A as Voicemeeter,S as types};
//# sourceMappingURL=index.modern.js.map
